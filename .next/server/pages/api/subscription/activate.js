"use strict";(()=>{var e={};e.id=600,e.ids=[600],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},3263:e=>{e.exports=import("firebase-admin/app")},9637:e=>{e.exports=import("firebase-admin/auth")},3073:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{config:()=>d,default:()=>u,routeModule:()=>l});var i=r(1802),s=r(7153),n=r(6249),o=r(4153),c=e([o]);o=(c.then?(await c)():c)[0];let u=(0,n.l)(o,"default"),d=(0,n.l)(o,"config"),l=new i.PagesAPIRouteModule({definition:{kind:s.x.PAGES_API,page:"/api/subscription/activate",pathname:"/api/subscription/activate",bundlePath:"",filename:""},userland:o});a()}catch(e){a(e)}})},4455:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.d(t,{x:()=>initAdmin});var i=r(3263),s=e([i]);function initAdmin(){0===(0,i.getApps)().length&&(0,i.initializeApp)({credential:(0,i.cert)({projectId:process.env.FIREBASE_PROJECT_ID,clientEmail:process.env.FIREBASE_CLIENT_EMAIL,privateKey:process.env.FIREBASE_PRIVATE_KEY?.replace(/\\n/g,"\n")})})}i=(s.then?(await s)():s)[0],a()}catch(e){a(e)}})},4153:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{default:()=>handler});var i=r(9637),s=r(4455),n=e([i,s]);async function handler(e,t){if("POST"!==e.method)return t.status(405).json({error:"Method not allowed"});try{let r=e.headers.authorization;if(!r?.startsWith("Bearer "))return t.status(401).json({error:"Unauthorized"});let a=r.split("Bearer ")[1];if(!a)return t.status(401).json({error:"No token provided"});let s=await (0,i.getAuth)().verifyIdToken(a),n=s.uid,{orderId:o,planId:c,paymentDetails:u}=e.body;if(!o||!c||!u)return t.status(400).json({error:"Missing required fields"});let d=await verifyPayPalPayment(o);if(!d.success)return t.status(400).json({error:"Invalid payment"});return await (0,i.getAuth)().setCustomUserClaims(n,{subscription:{plan:c,active:!0,orderId:o,activatedAt:new Date().toISOString()}}),t.status(200).json({success:!0,message:"Subscription activated successfully"})}catch(e){return console.error("Subscription activation error:",e),t.status(500).json({error:"Internal server error",message:"Failed to activate subscription"})}}async function verifyPayPalPayment(e){try{let t=Buffer.from("AfzMsfVxaLwoyuoZ-LTmP4PtXPo1qxq3MPmncSeuoHimJyZsLegbiaQMQVkf0TW4Mn7StTdeAhHVnLwE:EH9T-D9ObsjmI8FoSSFk5bCAFqZPz2O0sB7oiHqLl2xULxKBzkgyH0bm7wSTD3ChAac0q2dbn2zORBCU").toString("base64"),r=await fetch(`https://api-m.sandbox.paypal.com/v2/checkout/orders/${e}`,{method:"GET",headers:{Authorization:`Basic ${t}`,"Content-Type":"application/json"}});if(!r.ok)throw Error("Failed to verify PayPal payment");let a=await r.json();return{success:"COMPLETED"===a.status}}catch(e){return console.error("PayPal verification error:",e),{success:!1}}}[i,s]=n.then?(await n)():n,(0,s.x)(),a()}catch(e){a(e)}})}};var t=require("../../../webpack-api-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),r=t.X(0,[222],()=>__webpack_exec__(3073));module.exports=r})();